@page "/"
<PageTitle>Latest post | Blog</PageTitle>

<div class="container">
    <div class="row">

        <div class="col-12 d-block d-md-none mb-3 position-sticky top-0 bg-white py-2" style="z-index:1020; border-bottom:1px solid #ddd;">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="fs-5 m-0">Filters</h1>
                <button class="btn btn-primary btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileFilters" aria-controls="mobileFilters">
                    Open
                </button>
            </div>
        </div>

        <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileFilters" aria-labelledby="mobileFiltersLabel" @key="filterSidebarMobile">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="mobileFiltersLabel">Filters</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                @if (selectedTags.Any())
                {
                    <div class="mb-2">
                        <label>Selected tags:</label>
                        @foreach (var tag in selectedTags)
                        {
                            <span class="badge bg-dark me-1" style="cursor:pointer" @onclick="() => RemoveTag(tag)">
                                @tag &times;
                            </span>
                        }
                    </div>
                }

                <label>Language</label>
                <select class="form-select mb-2" @onchange="OnLanguageChanged">
                    <option value="">All</option>
                    @foreach (var lang in availableLanguages)
                    {
                        <option value="@lang">@lang</option>
                    }
                </select>

                <label>Author</label>
                <select class="form-select mb-2" @onchange="OnAuthorChanged">
                    <option value="">All</option>
                    @foreach (var author in availableAuthors)
                    {
                        <option value="@author.Id">@author.FirstName @author.LastName</option>
                    }
                </select>

                <label>Date From</label>
                <input type="date" class="form-control mb-2" value="@dateFromString"
                       @onchange="OnDateFromChanged" />

                <label>Date To</label>
                <input type="date" class="form-control mb-2" value="@dateToString"
                       @onchange="OnDateToChanged" />

                <div class="d-flex justify-content-between mt-3">
                    <button class="btn btn-secondary" @onclick="ClearAllFilters">Clear All</button>
                    <button class="btn btn-primary" @onclick="ApplyFiltersAndClose">Apply</button>
                </div>
            </div>
        </div>


 
        <div class="col-12 col-md-9">
            <h1 class="fs-3">Latest posts</h1>
            <hr />

            @if (posts == null  || !posts.Any())
            {
                <div class="d-flex justify-content-center flex-column align-items-center" style="min-height:250px">
                    <h3>No blog posts found.</h3>
                </div>
            }
            else
            {
                <ul class="list-unstyled">
                    @foreach (var post in posts)
                    {
                        var detailPageUrl = $"/blogpostdetails/{post.Id}";
                        <li class="mb-3">
                            <div class="border rounded p-3 mb-3" style="background-color:#f8f9fa;">
                                <div class="row">
                                    <div class="col-12">
                                        <NavLink href="@detailPageUrl" class="fs-5">@post.Title</NavLink>
                                    </div>
                                    @if (postTags.ContainsKey(post.Id) && postTags[post.Id].Any())
                                    {
                                        <div class="mb-2">
                                            @foreach (var tag in postTags[post.Id])
                                            {
                                                <span class="badge bg-dark me-1 bg-opacity-5" style="cursor:pointer" @onclick="() => OnTagClicked(tag.Name)">
                                                    @tag.Name
                                                </span>
                                            }
                                        </div>
                                    }
                                    <div class="col-12 mt-2">
                                        <h2 class="fs-6">@post.ShortDescription</h2>
                                        <small class="d-flex justify-content-between align-items-center">
                                            <label>@post.DatePublished.ToShortDateString()</label>
                                            <label>@post.AuthorFirstName @post.AuthorLastName</label>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </li>
                    }
                </ul>
            }
        </div>


        <div class="col-md-3 d-none d-md-block" @key="filterSidebar">
            <h1 class="fs-3">Filters</h1>
            <hr />

            @if (selectedTags.Any())
            {
                <div class="mb-2">
                    <label class="me-1">Selected tags:</label>
                    @foreach (var tag in selectedTags)
                    {
                        <span class="badge bg-dark me-1" style="cursor:pointer" @onclick="() => RemoveTag(tag)">
                            @tag &times;
                        </span>
                    }
                </div>
            }

            <label>Language</label>
            <select class="form-select mb-2" @onchange="OnLanguageChanged">
                <option value="">All</option>
                @foreach (var lang in availableLanguages)
                {
                    <option value="@lang">@lang</option>
                }
            </select>

            <label>Author</label>
            <select class="form-select mb-2" @onchange="OnAuthorChanged">
                <option value="">All</option>
                @foreach (var author in availableAuthors)
                {
                    <option value="@author.Id">@author.FirstName @author.LastName</option>
                }
            </select>

            <label>Date From</label>
            <input type="date" class="form-control mb-2" value="@dateFromString" max="@DateTime.Today.ToString("yyyy-MM-dd")"
                   @onchange="OnDateFromChanged"  />

            <label>Date To</label>
            <input type="date" class="form-control mb-2" value="@dateToString" max="@DateTime.Today.ToString("yyyy-MM-dd")"
                   @onchange="OnDateToChanged" />

            <button class="btn btn-secondary mt-2" @onclick="ClearAllFilters">Clear All</button>
        </div>

    </div>
</div>
